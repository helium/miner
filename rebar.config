%% -*- erlang -*-
{erl_opts, [
            debug_info,
            {parse_transform, lager_transform}
           ]}.

{project_plugins,
 [
  rebar3_lint
 ]}.

{cover_export_enabled, true}.
{cover_enabled, true}.

{deps, [
        {blockchain, {git, "git@github.com:helium/blockchain-core.git", {branch, "master"}}},
        {hbbft, {git, "https://github.com/helium/erlang-hbbft.git", {branch, "master"}}},
        {dkg, {git, "https://github.com/helium/erlang-dkg.git", {branch, "master"}}},
        {ebus, {git, "https://github.com/helium/ebus.git", {branch, "master"}}},
        {h3, {git, "https://github.com/helium/erlang-h3.git", {branch, "master"}}},
        recon
       ]}.

{xref_checks, [
               undefined_function_calls,
               undefined_functions,
               locals_not_used,
               deprecated_function_calls,
               deprecated_functions
              ]}.

{relx, [
        {release, {miner, "0.1.0"}, [miner, observer, runtime_tools, recon]},
        {release, {'miner-dev', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev1', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev2', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev3', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev4', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev5', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev6', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev7', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {release, {'miner-dev8', "0.1.0"}, [miner, observer, runtime_tools, wx]},
        {extended_start_script_hooks, [
                                       {post_start, [
                                                     {wait_for_process, blockchain_worker}
                                                    ]}
                                      ]},
        {generate_start_script, true},
        {extended_start_script, true},
        {extended_start_script_extensions, [
                                            {genesis, "extensions/genesis"},
                                            {hbbft, "extensions/hbbft"},
                                            {peer, "extensions/peer"},
                                            {ledger, "extensions/ledger"},
                                            {info, "extensions/info"},
                                            {trace, "extensions/trace"},
                                            {dkg, "extensions/dkg"},
                                            {authorize, "extensions/authorize"}
                                           ]},
        {overlay, [
                   {copy, "scripts/extensions/genesis", "bin/extensions/genesis"},
                   {copy, "scripts/extensions/hbbft", "bin/extensions/hbbft"},
                   {copy, "scripts/extensions/info", "bin/extensions/info"},
                   {copy, "scripts/extensions/dkg", "bin/extensions/dkg"},
                   {copy, "scripts/extensions/authorize", "bin/extensions/authorize"},
                   {copy, "./_build/default/lib/blockchain/scripts/extensions/peer", "bin/extensions/peer"},
                   {copy, "./_build/default/lib/blockchain/scripts/extensions/ledger", "bin/extensions/ledger"},
                   {copy, "./_build/default/lib/blockchain/scripts/extensions/trace", "bin/extensions/trace"},
                   {template, "config/sys.config", "{{output_dir}}/releases/{{release_version}}/sys.config"},
                   {template, "config/vm.args", "{{output_dir}}/releases/{{release_version}}/vm.args"}
                  ]},
        {dev_mode, true}
       ]}.

{profiles, [
            {prod, [
                    {relx, [
                            {overlay_vars, "config/prod.config"},
                            {dev_mode, false},
                            {include_src, false},
                            {system_libs, false},
                            {include_erts, false}]}]
            },
            {dev, [
                   {relx, [
                           {overlay_vars, "config/dev.config"},
                           {dev_mode, true},
                           {include_erts, false}]}]
            }]
}.

{elvis_output_format, plain}.
{elvis,
 [#{dirs => ["src"],
    filter => "*.erl",
    rules => [{elvis_style, line_length,
               #{ignore => [],
                 limit => 120,
                 skip_comments => false}},
              {elvis_style, no_tabs},
              {elvis_style, no_trailing_whitespace},
              {elvis_style, macro_names, #{ignore => []}},
              {elvis_style, macro_module_names},
              {elvis_style, operator_spaces, #{rules => [{right, ","},
                                                         {right, "++"},
                                                         {left, "++"}]}},
              {elvis_style, nesting_level, #{level => 5}},
              {elvis_style, god_modules,
               #{limit => 40,
                 ignore => []}},
              {elvis_style, no_if_expression},
              {elvis_style, invalid_dynamic_call,
               #{ignore => []}},
              %%{elvis_style, used_ignored_variable},
              {elvis_style, no_behavior_info},
              {
               elvis_style,
               module_naming_convention,
               #{regex => "^[a-z]([a-z0-9]*_?)*(_SUITE)?$",
                 ignore => []}
              },
              {
               elvis_style,
               function_naming_convention,
               #{regex => "^([a-z][a-z0-9]*_?)*$"}
              },
              %% {elvis_style, state_record_and_type},
              {elvis_style, no_spec_with_records},
              %% {elvis_style, dont_repeat_yourself, #{min_complexity => 10}},
              {elvis_style, no_debug_call, #{ignore => []}}
             ]
   }%% ,
  %% #{dirs => ["."],
  %%   filter => "Makefile",
  %%   rules => [{elvis_project, no_deps_master_erlang_mk, #{ignore => []}},
  %%             {elvis_project, protocol_for_deps_erlang_mk, #{ignore => []}}]
  %%  },
  %% #{dirs => ["."],
  %%   filter => "rebar.config",
  %%   rules => [{elvis_project, no_deps_master_rebar, #{ignore => []}},
  %%             {elvis_project, protocol_for_deps_rebar, #{ignore => []}}]
  %%  }
 ]
}.
